{% extends "layouts/base_booking.html" %}

{% block content %}
<div
    class="max-w-xl mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden mt-10 border border-gray-200 dark:border-gray-700">
    <div class="px-6 py-8">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div
            class="mb-4 p-4 rounded-md {% if category == 'error' %}bg-red-50 text-red-700{% else %}bg-blue-50 text-blue-700{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">
            {% if data.name %}Verifica tus Datos{% else %}Completa tu Perfil{% endif %}
        </h2>
        <p class="text-gray-600 dark:text-gray-400 mb-8">
            {% if data.name %}Confirma que tu informaciÃ³n de contacto estÃ© actualizada.{% else %}CuÃ©ntanos un poco mÃ¡s
            sobre ti.{% endif %}
        </p>

        <form method="POST" action="{{ url_for('booking.contact_details_view') }}" class="space-y-6">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

            <!-- Email (Read Only or Hidden if existing) -->
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Correo ElectrÃ³nico</label>
                <input type="email" value="{{ data.email or '' }}" disabled
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 sm:text-sm">
                <!-- If new user, we might need to send it back if not using session strictly, logic handles session['booking_email_input'] -->
            </div>

            <!-- Name -->
            <div>
                <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Nombre Completo
                    <span class="text-red-500 dark:text-red-400">*</span></label>
                <input type="text" name="name" id="name" value="{{ data.name or '' }}" required
                    class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 dark:border-gray-600 rounded-md p-2 border bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
            </div>

            <!-- Phone -->
            <div>
                <label for="phone" class="block text-sm font-medium text-gray-700 dark:text-gray-300">WhatsApp /
                    TelÃ©fono <span class="text-red-500 dark:text-red-400">*</span></label>
                <div class="mt-1 flex rounded-md shadow-sm">
                    <select name="phone_code"
                        class="focus:ring-indigo-500 focus:border-indigo-500 h-full py-2 pl-2 pr-7 border-transparent bg-gray-50 dark:bg-gray-700 text-gray-500 dark:text-gray-300 sm:text-sm rounded-md border-r border-gray-300 dark:border-gray-600 w-[110px]">
                        {% set countries = [
                        ('+51', 'ğŸ‡µğŸ‡ª PER'), ('+52', 'ğŸ‡²ğŸ‡½ MEX'), ('+57', 'ğŸ‡¨ğŸ‡´ COL'), ('+56', 'ğŸ‡¨ğŸ‡± CHL'),
                        ('+54', 'ğŸ‡¦ğŸ‡· ARG'), ('+34', 'ğŸ‡ªğŸ‡¸ ESP'), ('+1', 'ğŸ‡ºğŸ‡¸ USA'), ('+502', 'ğŸ‡¬ğŸ‡¹ GTM'),
                        ('+503', 'ğŸ‡¸ğŸ‡» SLV'), ('+504', 'ğŸ‡­ğŸ‡³ HND'), ('+505', 'ğŸ‡³ğŸ‡® NIC'), ('+506', 'ğŸ‡¨ğŸ‡· CRI'),
                        ('+507', 'ğŸ‡µğŸ‡¦ PAN'), ('+593', 'ğŸ‡ªğŸ‡¨ ECU'), ('+591', 'ğŸ‡§ğŸ‡´ BOL'), ('+595', 'ğŸ‡µğŸ‡¾ PRY'),
                        ('+598', 'ğŸ‡ºğŸ‡¾ URY'), ('+58', 'ğŸ‡»ğŸ‡ª VEN'), ('+1', 'ğŸ‡¨ğŸ‡¦ CAN'), ('+44', 'ğŸ‡¬ğŸ‡§ GBR'),
                        ('+33', 'ğŸ‡«ğŸ‡· FRA'), ('+39', 'ğŸ‡®ğŸ‡¹ ITA'), ('+49', 'ğŸ‡©ğŸ‡ª DEU'), ('+55', 'ğŸ‡§ğŸ‡· BRA'),
                        ('+1 787', 'ğŸ‡µğŸ‡· PRI'), ('+1 809', 'ğŸ‡©ğŸ‡´ DOM')
                        ] %}

                        {# Default to Peru (+51) if no code selected #}
                        {% set current_code = data.phone_code if data.phone_code else '+51' %}

                        {% for code, label in countries %}
                        <option value="{{ code }}" {% if current_code==code %}selected{% endif %}>{{ label }} {{ code }}
                        </option>
                        {% endfor %}
                        <option value="" {% if not current_code %}selected{% endif %}>Otro</option>
                    </select>
                    <input type="tel" name="phone" id="phone" value="{{ data.phone or '' }}" required
                        class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300 dark:border-gray-600 p-2 border bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                        placeholder="987 654 321">
                </div>
            </div>

            <!-- Instagram -->
            <div>
                <label for="instagram" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Usuario de
                    Instagram <span class="text-red-500 dark:text-red-400">*</span></label>
                <div class="mt-1 flex rounded-md shadow-sm">
                    <span
                        class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-500 dark:text-gray-400 sm:text-sm">@</span>
                    <input type="text" name="instagram" id="instagram" value="{{ data.instagram or '' }}" required
                        class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-none rounded-r-md sm:text-sm border-gray-300 dark:border-gray-600 p-2 border bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                        placeholder="usuario">
                </div>
            </div>

            <button type="submit"
                class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200">
                Siguiente: Encuesta
                <svg class="ml-2 -mr-1 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M14 5l7 7m0 0l-7 7m7-7H3" />
                </svg>
            </button>
        </form>
    </div>
</div>
{% endblock %}